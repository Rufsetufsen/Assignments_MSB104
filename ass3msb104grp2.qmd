---
title: "Assignment 3:"
subtitle:  "Regional GDP Inequality in 4 Selected European Economies - "
author: "Kristoffer Tufta and Harald Vika"
date: last-modified
date-format: "dddd D MMM, YYYY"
csl: apa7.csl
lang: en-GB
format:
  html: default
  typst:
    papersize: a4
  pdf: 
    documentclass: article
    number-sections: true
    keep-tex: true
    papersize: A4
    fig-pos: "H"
abstract: ""
editor: 
  markdown: 
    wrap: sentence
echo: false
bibliography: references.bib
---

```{r}
#| label: setup
#| include: FALSE
#| message: false
#| warning: false
library (tidyverse)
library (PxWebApiData)
library(readxl)
library(purrr)
library(dineq)
library(psych)
library(flextable)
library(modelsummary)
library(lmtest)

```

\# Part A: Testing development effects across subsets

```{r}
#Reading prewritten datasets
full_dataset <- readRDS("./data/tidyjoined2.rds")
xsection2017<- readRDS("./data/Gini_EUdata_full.rds") 
```

## Segmenting our cross-sectional data

### Population Density

Breaking down our population density into logical segments could help us make a more accurate regression line.
If we take a look at our dataset, the data varies a lot, where we have many rural regions with low population density, and then some large city-regions with a much higher density.
To define the classifications, we will be taking inspiration from Eurostat's own definition on urban clusters and density, which divides Europe into:

-   *"Urban centre (high-density cluster): a cluster of contiguous grid cells of 1 km² (excluding diagonals) with a population density of at least 1 500 inhabitants per km² and collectively a minimum population of 50 000 inhabitants after gap-filling*
-   *Urban cluster (moderate-density cluster): a cluster of contiguous grid cells of 1 km² (including diagonals) with a population density of at least 300 inhabitants per km² and a minimum population of 5 000 inhabitants*
-   *Rural grid cells: grid cells that aren’t identified as urban centres or as urban clusters."*

[@populati]

Their classification is based on continuous cell clusters of one square kilometer cells , whereas ours is for whole NUTS2-regions, but we will be using the same break values.

```{r}
#Population density
xsection2017 <- xsection2017 %>% 
  mutate(
    Density_class = cut(
      Pop_km2,
      breaks = c(0, 300, 1500, Inf),
      labels = c("Rural", "Medium Density", "High Density"),
      include.lowest = TRUE
    )
  )

```

```{r}
#| label: tbl-MLR
#| fig-cap: "Multiple Regression - Regional GDP Inequality as a function of GDP and population density."
as_flextable (lm(gini ~ chg_gdpc + Pop_km2, data = xsection2017
))%>%
  colformat_double(j = 2, digits = 6)
```

```{r}
#| label: tbl-Reg_HD
#| fig-cap: "Effect of GDP change on regional inequality - High population density "
#| Title: "Effect of GDP change on regional inequality - High population density "
#Reg. High density
xsection2017 %>%
  filter(Density_class == "High Density") %>%
  lm(formula = gini ~ chg_gdpc)%>%
as_flextable()
```

Running a regression model on our high density subsection, we get a negative relationship (-0,020) between an increase in GDP per capita and our calculated Gini coefficient. The result is however barely statistically insignificant, with a P-value of 0,08. 

```{r}
#| label: tbl-Reg_MD
#| fig-cap: "Effect of GDP change on regional inequality - Medium population density "
#| Title: "Effect of GDP change on regional inequality - Medium population density "
#Reg. Med. Density
xsection2017 %>%
  filter(Density_class == "Medium Density") %>%
  lm(formula = gini ~ chg_gdpc)%>%
as_flextable()
```

Running the same model for our medium density section, we see a positive relationship between the two variables. The result is however not statistically significant, with a P-value of 0,59.

```{r}
#| label: tbl-Reg_Rural
#| fig-cap: "Effect of GDP change on regional inequality - Rural population density "
#| Title: "Effect of GDP change on regional inequality - Rural population density "
#Reg. Rural
xsection2017 %>%
  filter(Density_class == "Rural") %>%
  lm(formula = gini ~ chg_gdpc)%>%
as_flextable()
```

Our rural section is also not statistically significant, but the relationship flips to negative again.

### Workforce

Our data on available workforce is much more linear than for population density, so here we will simply be doing a quantile split into three equally sized classifications: "low", "medium" and "high" workforce.

```{r}
#Workforce
xsection2017 <- xsection2017 %>%
  mutate(Workforce_Class = cut(Workforce,
                           breaks = quantile(Workforce, probs = c(0, 1/3, 2/3, 1), na.rm = TRUE),
                           include.lowest = TRUE,
                           labels = c("Low", "Medium", "High")))

```

```{r}
#| label: tbl-Reg_Work_High
#| fig-cap: "Effect of GDP change on regional inequality - High available workforce"
#| Title: "Effect of GDP change on regional inequality - High available workforce"
xsection2017 %>%
  filter(Workforce_Class == "High") %>%
  lm(formula = gini ~ chg_gdpc) %>%
  as_flextable()

```

When applying our model on the "high available workforce"-subset, we see a positive relationship between GDP change and Gini, although it is not statistically significant.
```{r}
#| label: tbl-Reg_Work_Medium
#| fig-cap: "Effect of GDP change on regional inequality - Medium available workforce"
#| Title: "Effect of GDP change on regional inequality - Medium available workforce"
xsection2017 %>%
  filter(Workforce_Class == "Medium") %>%
  lm(formula = gini ~ chg_gdpc) %>%
  as_flextable()

```

For our "medium workforce", the relationship inverts again, but also here statistically insignificant

```{r}
#| label: tbl-Reg_Work_Low
#| fig-cap: "Effect of GDP change on regional inequality - Low available workforce"
#| Title: "Effect of GDP change on regional inequality - Low available workforce"
xsection2017 %>%
  filter(Workforce_Class == "Low") %>%
  lm(formula = gini ~ chg_gdpc) %>%
  as_flextable()

```

Low available workforce inverts the relationship once again, but also here statistically insignificant.

### Unemployment Rate

For unemployment rate, we have a pretty continuous spread from 2% to 7%, before we see a few outliers with much higher unemployment rates, relative to the rest of the dataset. We have chosen to section our datasets into three sections: low, medium and high unemployment rates, with breaks being at 0%, >5% and >10%  
```{r}
xsection2017 <- xsection2017 %>%
  mutate(
    Unemp_Class = cut(
      Unemp_prct,
      breaks = c(0, 5, 10, Inf),
      labels = c("Low", "Medium", "High"),
      include.lowest = TRUE
    )
  )

```

```{r}
#| label: tbl-Reg_Unemp_High
#| fig-cap: "Effect of GDP change on regional inequality - High unemployment"
#| Title: "Effect of GDP change on regional inequality - High unemployment"
xsection2017 %>%
  filter(Unemp_Class == "High") %>%
  lm(formula = gini ~ chg_gdpc) %>%
  as_flextable()

```
The regression line in @tbl-Reg_Unemp_High is missing standard error, t-value and p-value due to only containing two observations.

```{r}
#| label: tbl-Reg_Unemp_Medium
#| fig-cap: "Effect of GDP change on regional inequality - Medium unemployment"
#| Title: "Effect of GDP change on regional inequality - Medium unemployment"
xsection2017 %>%
  filter(Unemp_Class == "Medium") %>%
  lm(formula = gini ~ chg_gdpc) %>%
  as_flextable()

```
In the "medium unemployment" subsection, we see that there is a small, negative, but statistically insignificant relationship between increasing GDP per capita and regional inequality.

```{r}
#| label: tbl-Reg_Unemp_Low
#| fig-cap: "Effect of GDP change on regional inequality - Low unemployment"
#| Title: "Effect of GDP change on regional inequality - Low unemployment"
xsection2017 %>%
  filter(Unemp_Class == "Low") %>%
  lm(formula = gini ~ chg_gdpc) %>%
  as_flextable()

```
For our "low unemployment" subset however, the relationship between GDPC increase and regional inequality is positive, but still statistically insignificant.
